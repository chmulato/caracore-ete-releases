
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="https://chmulato.github.io/ETE-releases/">
    <title>Apostila de Tratamento de Efluentes</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Roboto+Mono&display=swap');

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #e0f7fa 0%, #e3f2fd 100%);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        .quadro {
            background: linear-gradient(90deg, #e3f2fd 80%, #b2ebf2 100%);
            border-left: 7px solid #039be5;
            padding: 20px 36px 20px 28px;
            margin: 22px 0;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(33, 150, 243, 0.07);
            color: #17406a;
            width: 100%;
            box-sizing: border-box;
            overflow-x: visible;
        }

        .quadro pre {
            background: #e0eafc;
            margin: 12px 0 0 0;
            padding: 14px 18px;
            border-radius: 5px;
            font-size: 15px;
            overflow-x: visible;
            width: 100%;
            box-sizing: border-box;
            white-space: pre-wrap;
            word-break: break-word;
        }
        }

        @page {
            size: A4 landscape;
            margin: 1cm;
        }

        .page {
            background: rgba(255,255,255,0.98);
            width: 100%;
            max-width: 900px;
            min-height: 60vh;
            padding: 40px 32px 40px 32px;
            margin: 36px auto 28px auto;
            box-shadow: 0 4px 32px rgba(33, 150, 243, 0.10), 0 1.5px 0 #b3e5fc inset;
            border-radius: 18px;
            border: 1.5px solid #b3e5fc;
            overflow: visible;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        .img-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 32px 0 24px 0;
        }

        .img-center img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(25, 118, 210, 0.10);
        }

        /* Classes para diferentes tamanhos de imagem */
        .img-center img.img-small {
            max-width: 60%;
            max-height: 400px;
            object-fit: contain;
        }
        
        .img-center img.img-normal {
            max-width: 85%;
            max-height: 600px;
            object-fit: contain;
        }
        
        .img-center img.img-medium {
            max-width: 75%;
            max-height: 700px;
            object-fit: contain;
        }
        
        .img-center img.img-large {
            max-width: 70%;
            max-height: 800px;
            object-fit: contain;
        }
        
        .img-center img.img-very-large {
            max-width: 65%;
            max-height: 900px;
            object-fit: contain;
        }
        
        /* Ajustes para imagens muito largas (landscape) */
        .img-center img.img-wide {
            max-width: 90%;
            max-height: 500px;
        }
        
        /* Ajustes para imagens muito altas (portrait) */
        .img-center img.img-tall {
            max-width: 50%;
            max-height: 1000px;
        }
        
        /* Combinações específicas */
        .img-center img.img-large.img-wide {
            max-width: 85%;
            max-height: 600px;
        }
        
        .img-center img.img-large.img-tall {
            max-width: 55%;
            max-height: 900px;
        }
        
        .img-center img.img-medium.img-wide {
            max-width: 80%;
            max-height: 550px;
        }

        .img-caption {
            font-size: 15px;
            color: #2a3a4a;
            margin-top: 10px;
            text-align: center;
            max-width: 90%;
        }

        .cover {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .cover h1 {
            font-size: 52px;
            color: #0277bd;
            margin-bottom: 20px;
            letter-spacing: 1.5px;
            text-shadow: 0 2px 8px #b3e5fc;
        }

        .cover h2 {
            font-size: 28px;
            color: #039be5;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        h1, h2, h3, h4 {
            color: #0277bd;
            border-bottom: 1px solid #b3e5fc;
            padding-bottom: 10px;
            margin-top: 24px;
            font-weight: 700;
        }
        h1 { font-size: 30px; }
        h2 { font-size: 25px; }
        h3 { font-size: 21px; }
        h4 { font-size: 17px; }

        p, ul, li {
            line-height: 1.6;
            color: #333;
            font-size: 14px;
        }

        ul {
            padding-left: 20px;
        }
        
        li {
            margin-bottom: 8px;
        }

        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: visible;
            white-space: pre-wrap;
            word-break: break-word;
        }

        code {
            font-family: 'Roboto Mono', monospace;
            background-color: #e0e0e0;
            padding: 2px 5px;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
            border-radius: 0;
        }
        
        hr {
            border: 0;
            border-top: 1px solid #ddd;
            margin: 20px 0;
        }

        .toc {
            background: linear-gradient(135deg, #e3f2fd 0%, #b2ebf2 100%);
            border: 2px solid #039be5;
        }

        .toc ol {
            list-style-type: decimal;
            padding-left: 30px;
            margin: 20px 0;
        }

        .toc ol ul {
            list-style-type: disc;
            padding-left: 40px;
            margin-top: 8px;
            margin-bottom: 8px;
        }

        .toc li {
            margin: 10px 0;
            line-height: 1.6;
        }

        .toc a {
            text-decoration: none;
            color: #0277bd;
            font-weight: 500;
        }
        .toc a:hover {
            text-decoration: underline;
            color: #01579b;
        }
    </style>
</head>
<body>

    <div class="page cover">
        <div class="img-center">
            <img src="assets/images/aulas/prompt_00_capa_apostila.png" alt="Capa da Apostila ETE Lodos Ativados" class="img-large img-tall">
            <div class="img-caption">Capa: Estações de Tratamento de Efluentes com Lodos Ativados – Engenharia, Ciência e Sustentabilidade.</div>
        </div>
        <h1>Apostila de Simulação e Tratamento de Efluentes</h1>
        <h2>Sistema Completo de Lodos Ativados</h2>
        <p>Um compêndio baseado na documentação do projeto "CHI".</p>
    </div>

    <div class="page toc">
        <h1>Índice</h1>
        <ol>
            <li><a href="#cap-intro">Introdução</a></li>
            <li><a href="#cap-1">Aula - Reforço de Conceitos</a></li>
            <li><a href="#cap-2">Aula - Inventividade no Processo: A Física da Recirculação</a></li>
            <li><a href="#cap-3">Aula - Recirculação de Lodo e Idade do Lodo (θc)</a></li>
            <li><a href="#cap-4">Aula - Dimensionamento de Decantador Secundário</a></li>
            <li><a href="#cap-5">README Geral do Sistema</a>
                <ul>
                    <li><a href="#cap-5">Interface Visual do Simulador</a></li>
                </ul>
            </li>
            <li><a href="#cap-6">README - Conformidade Legal</a></li>
            <li><a href="#cap-7">README - Validação Termodinâmica</a></li>
            <li><a href="#cap-8">Próximos Passos Implementados</a></li>
            <li><a href="#cap-9">Matriz de Petersen - Teoria e Modelo Dinâmico</a></li>
            <li><a href="#cap-10">Matriz de Petersen - Implementação e Integração</a></li>
            <li><a href="#cap-conc">Conclusão</a></li>
        </ol>
    </div>

    <div class="page" id="cap-intro">
        <h1>Introdução</h1>
        <p>Esta apostila consolida a documentação técnica do "Simulador de Efluentes", um sistema completo para simulação e dimensionamento de Estações de Tratamento de Efluentes (ETE) utilizando o processo de Lodos Ativados.</p>
        <p>O conteúdo abrange desde os princípios fundamentais da engenharia química e sanitária, como balanço de massa e cinética biológica, até a implementação prática em código, incluindo o dimensionamento de reatores, decantadores, sistemas de lodo, e a verificação de conformidade com as normas ambientais.</p>
        <p>O objetivo é servir como um guia de estudo e referência, refletindo a filosofia de "Física antes da Lógica", onde a compreensão dos fenômenos precede a escrita do código. Cada seção representa um módulo da documentação original do projeto, organizada de forma lógica para facilitar o aprendizado.</p>
    </div>

    <div class="page" id="cap-1">
        <div class="img-center">
            <img src="assets/images/aulas/prompt_01.png" alt="Fluxograma do Processo de Lodos Ativados" class="img-large img-wide">
            <div class="img-caption">Figura 1: Fluxograma do Processo de Lodos Ativados, destacando reator, decantador e recirculação de lodo.</div>
        </div>
        <h1>Capítulo 1: Aula - Reforço de Conceitos</h1>
        <p>Esta seção revisa os conceitos fundamentais que formam a base do tratamento de efluentes por lodos ativados.</p>
        <hr>
        
        <h2>1. RELATÓRIO DE STATUS - O QUE O CÓDIGO JÁ FAZ</h2>

        <h3>1.1 Balanço de Massa (Conservação de Lavoisier)</h3>
        <p>O sistema realiza balanços de massa estequiométricos baseados no princípio de conservação de massa de Lavoisier. Isso significa que: <code>Massa que entra = Massa que sai + Massa acumulada + Massa consumida</code>.</p>
        <pre><code># Exemplo de cálculo de carga
Carga = Concentração × Vazão × Fator de conversão
Demanda O₂ (DBO): 1 kg DBO requer 1.42 kg O₂
Demanda O₂ (Nitrificação): 1 kg N requer 4.57 kg O₂</code></pre>
        <div class="quadro">
            <b>Balanço de Massa:</b> O sistema realiza balanços de massa estequiométricos baseados no princípio de conservação de massa de Lavoisier.<br>
            <code>Massa que entra = Massa que sai + Massa acumulada + Massa consumida</code>
            <pre><code># Exemplo de cálculo de carga
    Carga = Concentração × Vazão × Fator de conversão
    Demanda O₂ (DBO): 1 kg DBO requer 1.42 kg O₂
    Demanda O₂ (Nitrificação): 1 kg N requer 4.57 kg O₂</code></pre>
        </div>
        
        <h3>1.2 Integração com SQLite</h3>
        <p>O banco de dados armazena: Efluentes, Aeradores, Normas Ambientais (CONAMA 430), e Limites Físicos para validação.</p>

        <h3>1.3 Validação de Dados (Consistência Termodinâmica)</h3>
        <p>O sistema bloqueia cálculos com dados fisicamente impossíveis, como DBO > DQO, pH fora da faixa biológica, ou vazão nula. Isso previne o erro "Garbage In, Garbage Out" (GIGO).</p>
        <div class="quadro">
            <b>Validação de Dados:</b> O sistema bloqueia cálculos com dados fisicamente impossíveis, como DBO &gt; DQO, pH fora da faixa biológica, ou vazão nula.<br>
            <i>Isso previne o erro "Garbage In, Garbage Out" (GIGO).</i>
        </div>

        <h2>2. REVISÃO DE CONCEITOS FUNDAMENTAIS</h2>
        
        <h3>2.1 DQO vs DBO - A Diferença Essencial</h3>
        <p><b>DBO (Demanda Bioquímica de Oxigênio):</b> Mede a porção da matéria orgânica que é biodegradável.</p>
        <p><b>DQO (Demanda Química de Oxigênio):</b> Mede TODA a matéria orgânica oxidável, incluindo a não biodegradável. Por isso, <strong>DQO ≥ DBO sempre</strong>.</p>
        <div class="quadro">
            <b>DBO (Demanda Bioquímica de Oxigênio):</b> Mede a porção da matéria orgânica que é biodegradável.<br>
            <b>DQO (Demanda Química de Oxigênio):</b> Mede TODA a matéria orgânica oxidável, incluindo a não biodegradável. <strong>DQO ≥ DBO sempre</strong>.
        </div>
        
        <h3>2.2 F/M (Alimento/Microrganismo) - O "Apetite" do Reator</h3>
        <p>É a relação entre o alimento (Carga de DBO) e a massa de microrganismos. Controla a eficiência e o tamanho do reator.</p>
        <div class="quadro">
            <b>F/M (Alimento/Microrganismo):</b> É a relação entre o alimento (Carga de DBO) e a massa de microrganismos. Controla a eficiência e o tamanho do reator.
        </div>
        <pre><code>F/M = (Q × S₀) / (V × X)</code></pre>
        <ul>
            <li>F/M alto: Reator menor, menos eficiente.</li>
            <li>F/M baixo: Reator maior, mais eficiente.</li>
        </ul>
        
        <h3>2.3 Idade do Lodo (Theta_c) - O "Relógio Biológico" da ETE</h3>
        <p>É o tempo médio que uma bactéria permanece no sistema. Controla quais tipos de bactérias prosperam.</p>
        <div class="quadro">
            <b>Idade do Lodo (θc):</b> É o tempo médio que uma bactéria permanece no sistema. Controla quais tipos de bactérias prosperam.
        </div>
        <pre><code>θc = Massa de lodo no sistema / Massa de lodo descartada por dia</code></pre>
        <ul>
            <li><b>θc = 5-10 dias:</b> Remoção de DBO, risco de bulking.</li>
            <li><b>θc = 15-30 dias:</b> Nitrificação completa, lodo mais estável.</li>
        </ul>
        <hr>
        <p><b>O que falta implementar nesta etapa:</b> Cálculo do volume do reator baseado em F/M, cálculo de θc, e dimensionamento do sistema de decantação e recirculação.</p>
    </div>

    <div class="page" id="cap-2">
        <div class="img-center">
            <img src="assets/images/aulas/prompt_02.png" alt="Balanço de Massa em ETE" class="img-large img-wide">
            <div class="img-caption">Figura 2: Ilustração do balanço de massa em uma ETE, mostrando entradas, saídas e acúmulo.</div>
        </div>
        <h1>Capítulo 2: Aula - Inventividade no Processo</h1>
        <p>Esta seção explora o conceito de "Inventividade no Processo", focando em como a recirculação de lodo otimiza o tratamento.</p>
        <hr>

        <h2>A RECIRCULAÇÃO COMO "INVENTIVIDADE"</h2>
        <p>Recircular o lodo do decantador de volta para o reator é uma "inventividade" pois permite manter uma alta concentração de microrganismos (X) no reator, o que traz duas grandes vantagens:</p>
        <ol>
            <li><b>Permite um reator menor:</b> Se a concentração de lodo (X) aumenta, o volume do reator (V) pode diminuir para tratar a mesma carga, mantendo a relação F/M constante.</li>
            <li><b>Permite tratar uma carga maior:</b> Com um reator de mesmo volume, uma maior concentração de lodo (X) permite tratar uma carga orgânica (Q x S0) maior.</li>
        </ol>

        <h2>A FÍSICA: POR QUE R PERMITE REATOR MENOR?</h2>
        <p>A fórmula chave é a do F/M: <code>F/M = (Q × S0) / (V × X)</code>. Ao recircular, X aumenta de ~500 mg/L para ~3000 mg/L (um aumento de 6x). Para manter o mesmo F/M, o volume V pode ser 6x menor.</p>
        
        <h3>DERIVAÇÃO DA FÓRMULA DE RECIRCULAÇÃO</h3>
        <p>Através de um balanço de massa, chega-se à fórmula da razão de recirculação (R):</p>
        <pre><code>R = X / (Xr - X)</code></pre>
        <p>Onde <code>X</code> é a concentração no reator e <code>Xr</code> é a concentração no lodo recirculado (do fundo do decantador), que é sempre maior que X.</p>

        <h3>EXEMPLO NUMÉRICO</h3>
        <ul>
            <li><b>Sem Recirculação (X=500 mg/L):</b> Para tratar uma carga, precisa-se de um reator de <b>1000 m³</b>.</li>
            <li><b>Com Recirculação (X=3000 mg/L):</b> Para tratar a mesma carga, precisa-se de um reator de <b>167 m³</b>. Uma economia de 83% no volume!</li>
        </ul>
        <div class="quadro">
            <b>Exemplo Numérico:</b>
            <ul>
                <li><b>Sem Recirculação (X=500 mg/L):</b> Para tratar uma carga, precisa-se de um reator de <b>1000 m³</b>.</li>
                <li><b>Com Recirculação (X=3000 mg/L):</b> Para tratar a mesma carga, precisa-se de um reator de <b>167 m³</b>. Uma economia de 83% no volume!</li>
            </ul>
        </div>

        <h2>RESUMO PARA O ENGENHEIRO</h2>
        <p>Aumentar a razão de recirculação (R) aumenta a concentração de lodo (X) no reator. Isso permite ou diminuir o volume (V) do reator ou aumentar a carga (Q x S0) a ser tratada.</p>
    </div>
    
    <div class="page" id="cap-3">
        <div class="img-center">
            <img src="assets/images/aulas/prompt_03.png" alt="Comparação F/M" class="img-large img-wide">
            <div class="img-caption">Figura 3: Comparação visual entre reatores com alta e baixa relação F/M.</div>
        </div>
        <h1>Capítulo 3: Aula - Recirculação e Idade do Lodo</h1>
        <p>Esta seção detalha os cálculos envolvidos no sistema de lodo, incluindo recirculação, produção, descarte e a idade do lodo (θc).</p>
        <hr>
        
        <h2>1. RECIRCULAÇÃO DE LODO</h2>
        <p>É o processo de bombear lodo do decantador de volta para o reator para manter a concentração de microrganismos (X) e controlar a Idade do Lodo (θc).</p>
        <p>A Razão de Recirculação (R) é calculada por: <code>R = X / (Xr - X)</code>.</p>
        
        <h2>2. PRODUÇÃO DE LODO</h2>
        <p>As bactérias crescem ao consumir DBO, mas também morrem (respiração endógena). A produção líquida de lodo (Px) deve ser descartada para manter o equilíbrio.</p>
        <pre><code>Px = Y × (S₀ - S) × Q - kd × X × V</code></pre>
        <ul>
            <li><b>Termo de crescimento:</b> Lodo produzido ao remover DBO.</li>
            <li><b>Termo de morte:</b> Lodo perdido por respiração endógena.</li>
        </ul>
        
        <h2>3. DESCARTE DE LODO</h2>
        <p>O descarte (Qw) é necessário para controlar a idade do lodo. A vazão de descarte é calculada para remover a produção líquida de lodo (Px).</p>
        <pre><code>Qw = Px / Xr</code></pre>
        
        <h2>4. IDADE DO LODO (θc)</h2>
        <p>É o tempo médio que uma bactéria fica no sistema. É o parâmetro de controle mais importante.</p>
        <pre><code>θc = (V × X) / (Qw × Xr)</code></pre>
        <p>A idade do lodo determina quais bactérias dominam o sistema:</p>
        <ul>
            <li><b>θc < 5 dias:</b> Sistema instável, tratamento ineficiente.</li>
            <li><b>θc = 5-10 dias:</b> Boa remoção de DBO. Risco de bulking. Nitrificação limitada.</li>
            <li><b>θc = 15-30 dias:</b> Nitrificação completa. Lodo estável. Ideal para remoção de nitrogênio.</li>
        </ul>
        <p>Para que a nitrificação ocorra, <b>θc deve ser, no mínimo, 10-12 dias</b>, pois as bactérias nitrificantes crescem muito lentamente.</p>
    </div>

    <div class="page" id="cap-4">
        <div class="img-center">
            <img src="assets/images/aulas/prompt_04.png" alt="Recirculação de Lodo" class="img-large img-tall">
            <div class="img-caption">Figura 4: Esquema da recirculação de lodo do decantador para o reator biológico.</div>
        </div>
        <h1>Capítulo 4: Aula - Dimensionamento de Decantador</h1>
        <p>Esta seção aborda o dimensionamento do decantador secundário, uma etapa crucial para garantir a clarificação do efluente final.</p>
        <hr>

        <h2>1. VELOCIDADE DE SEDIMENTAÇÃO (Vs)</h2>
        <p>É a velocidade com que os flocos de lodo "caem" no decantador. Fatores que afetam Vs:</p>
        <ul>
            <li><b>Concentração de lodo (X):</b> Se muito alta, as partículas interferem umas nas outras, diminuindo a Vs.</li>
            <li><b>Qualidade do lodo:</b> Lodo com "bulking" (muitas bactérias filamentosas) sedimenta mal.</li>
            <li><b>Temperatura:</b> Água mais quente é menos viscosa, facilitando a sedimentação.</li>
        </ul>
        
        <h2>2. DIMENSIONAMENTO DA ÁREA DO DECANTADOR</h2>
        <p>A área do decantador (A) deve ser grande o suficiente para que o tempo de sedimentação seja menor que o tempo de detenção.</p>
        <pre><code>A ≥ Q / Vs</code></pre>
        <p>Onde <code>Q</code> é a vazão total (efluente + recirculação) e <code>Vs</code> é a velocidade de sedimentação. Um fator de segurança é aplicado.</p>

        <h2>3. TAXA DE APLICAÇÃO SUPERFICIAL (TAS)</h2>
        <p>É a vazão aplicada por unidade de área. É um parâmetro de projeto importante para evitar sobrecarga hidráulica.</p>
        <pre><code>TAS = Q / A  (em m³/m²·dia)</code></pre>
        <ul>
            <li><b>TAS muito alta:</b> Lodo é arrastado para fora do decantador.</li>
            <li><b>TAS muito baixa:</b> Decantador superdimensionado e caro.</li>
        </ul>
        
        <h2>4. ÍNDICE DE VOLUME DE LODO (IVL)</h2>
        <p>Mede a "qualidade" e a capacidade de compactação do lodo. É a principal ferramenta para diagnosticar problemas de sedimentação.</p>
        <pre><code>IVL = (Volume de lodo sedimentado em 30 min) / (Massa de lodo)</code></pre>
        <ul>
            <li><b>IVL = 50-150 mL/g:</b> Lodo ideal, sedimenta e compacta bem.</li>
            <li><b>IVL > 200 mL/g:</b> Indica <strong>BULKING</strong>. O lodo está "fofo", não compacta e é facilmente arrastado para fora.</li>
        </ul>

        <h2>5. BULKING - O PROBLEMA</h2>
        <p>Ocorre quando bactérias filamentosas crescem excessivamente, criando uma estrutura que impede a compactação do lodo. Causa turbidez no efluente final e perda de sólidos.</p>
        
        <div class="img-center">
            <img src="assets/images/aulas/prompt_05.png" alt="Decantador Secundário - Condição Normal vs. Bulking" class="img-large img-wide">
            <div class="img-caption">Figura 5: Comparação visual entre decantador em condição normal (esquerda) e em situação de bulking (direita). A imagem mostra a diferença na sedimentação, interface lodo/água, compactação do lodo e qualidade do efluente, incluindo indicadores de IVL (Índice de Volume de Lodo) e causas do problema (θc baixo, falta de nutrientes, baixa concentração de O₂).</div>
        </div>
        
        <p>A imagem acima ilustra claramente a diferença entre um decantador operando normalmente e um em situação de bulking. No decantador normal, observa-se sedimentação adequada, interface lodo/água bem definida, lodo compactado no fundo e efluente clarificado. No decantador com bulking, o lodo não sedimenta adequadamente, a interface é difusa, o lodo ocupa grande volume e o efluente sai turvo, indicando risco de arraste de sólidos.</p>
        
        <div class="quadro">
            <b>Diagnóstico e Prevenção de Bulking:</b><br>
            <ul>
                <li><b>IVL ideal:</b> 50-150 mL/g (sedimentação adequada)</li>
                <li><b>Alerta:</b> IVL > 200 mL/g (risco de bulking)</li>
                <li><b>Causas principais:</b> θc muito baixo (&lt; 5 dias), falta de nutrientes, baixa concentração de O₂</li>
                <li><b>Soluções preventivas:</b> Manter θc adequado (10-30 dias), garantir O₂ suficiente, monitorar IVL regularmente</li>
            </ul>
        </div>
    </div>

    <div class="page" id="cap-5">
        <h1>Capítulo 5: README Geral do Sistema</h1>
        <p>Visão geral do Simulador de Efluentes, um sistema completo para simulação e dimensionamento de ETEs de Lodos Ativados.</p>
        <hr>

        <h2>Interface Visual do Simulador</h2>
        <p>O sistema oferece uma interface visual completa desenvolvida com Streamlit, permitindo entrada interativa de dados e visualização imediata dos resultados de dimensionamento.</p>
        
        <div class="img-center">
            <img src="assets/images/aulas/simulador_ete.png" alt="Interface do Simulador de Efluentes" class="img-medium">
            <div class="img-caption">Figura 5.1: Interface visual do Simulador de Efluentes mostrando entrada de dados na barra lateral, resultados principais em cards, gráfico de DBO (Entrada vs Saída vs Limite CONAMA), e detalhes completos do sistema (reator, decantador, lodo, demanda de oxigênio).</div>
        </div>
        
        <h3>Características da Interface</h3>
        <ul>
            <li><b>Entrada de Dados Interativa:</b> Barra lateral com campos para vazão, DBO, TKN, temperatura, pH e parâmetros de dimensionamento.</li>
            <li><b>Simulação Automática:</b> Opção para atualização em tempo real dos resultados ao alterar parâmetros.</li>
            <li><b>Modelo Cinético:</b> Checkbox para escolher entre método estático (rápido) ou Matriz de Petersen (dinâmico e exato).</li>
            <li><b>Visualização de Resultados:</b> Cards com métricas principais, gráficos comparativos e tabelas detalhadas.</li>
            <li><b>Análise de Conformidade:</b> Verificação automática contra normas CONAMA 430/2011.</li>
            <li><b>Dimensionamento Completo:</b> Cálculo de reator, decantador, recirculação, produção de lodo e demanda de oxigênio.</li>
        </ul>
        
        <h3>Como Executar</h3>
        <pre><code># Instalar dependências
pip install -r requirements.txt

# Executar interface
streamlit run interface.py

# Acessar no navegador
# http://localhost:8501</code></pre>

        <h2>Funcionalidades Principais</h2>
        <ul>
            <li><b>Cálculo da Demanda de Oxigênio Total (OT):</b> Para DBO e Nitrificação.</li>
            <li><b>Dimensionamento do Reator Biológico:</b> Baseado em F/M, calcula Volume, TDH e Carga Volumétrica.</li>
            <li><b>Sistema de Recirculação de Lodo:</b> Calcula Razão (R) e Vazão (Qr) de recirculação.</li>
            <li><b>Produção e Descarte de Lodo:</b> Calcula produção (Px), descarte (Qw) e Idade do Lodo (θc).</li>
            <li><b>Dimensionamento do Decantador Secundário:</b> Calcula área, Vs, TAS e valida o risco de bulking via IVL.</li>
            <li><b>Validação de Conformidade Legal:</b> Contra a norma CONAMA 430/2011.</li>
            <li><b>Validação de Consistência Termodinâmica:</b> Previne GIGO.</li>
            <li><b>Interface Visual (Streamlit):</b> Para simulação interativa.</li>
        </ul>

        <h2>Estrutura do Projeto</h2>
        <p>O projeto é modular, separando responsabilidades:</p>
        <pre><code>database.py         # Banco de dados
calculos.py         # Cálculos centrais
dimensionamento.py    # Dimensionamento de reator/decantador
recirculacao.py     # Lógica de lodo
conformidade.py     # Regras da CONAMA
validacao.py        # Validação de dados de entrada
interface.py        # UI com Streamlit</code></pre>
    </div>
    
    <div class="page" id="cap-6">
        <div class="img-center">
            <img src="assets/images/aulas/prompt_06.png" alt="Verificação de Conformidade Legal" class="img-large img-tall">
            <div class="img-caption">Figura 6: Diagrama de verificação de conformidade legal do efluente segundo a norma CONAMA 430/2011.</div>
        </div>
        <h1>Capítulo 6: README - Conformidade Legal</h1>
        <p>Detalhes do módulo que verifica a conformidade legal do efluente tratado, com base na norma CONAMA 430/2011.</p>
        <hr>

        <h2>Lógica de Verificação</h2>
        <p>Um efluente é considerado <strong>CONFORME</strong> se atender a <strong>pelo menos um</strong> dos seguintes critérios:</p>
        <ol>
            <li>A concentração do poluente na saída for <strong>menor ou igual</strong> ao limite máximo estabelecido (ex: DBO ≤ 120 mg/L).</li>
            <li>A eficiência de remoção do poluente for <strong>maior ou igual</strong> à eficiência mínima exigida (ex: Remoção de DBO ≥ 60%).</li>
        </ol>

        <h2>Déficit de Engenharia</h2>
        <p>Quando o efluente é considerado INCONFORME, o sistema calcula o "Déficit de Engenharia". Este valor representa a carga poluidora (em kg/dia) que está sendo lançada no corpo receptor acima do permitido por lei, caracterizando um problema ambiental e de engenharia a ser corrigido.</p>
        
        <h2>Uso</h2>
        <p>O módulo pode ser usado tanto via uma interface de terminal interativa (`menu_conformidade.py`) quanto programaticamente, integrando-se aos outros módulos de cálculo para uma verificação automática ao final de cada simulação.</p>
    </div>

    <div class="page" id="cap-7">
        <div class="img-center">
            <img src="assets/images/aulas/prompt_07.png" alt="Validação Termodinâmica" class="img-large img-wide">
            <div class="img-caption">Figura 7: Ilustração da validação termodinâmica e bloqueio de dados inconsistentes no sistema.</div>
        </div>
        <h1>Capítulo 7: README - Validação Termodinâmica</h1>
        <p>Este módulo atua como um "guardião" do sistema, garantindo que nenhum cálculo seja realizado com dados fisicamente impossíveis ou inconsistentes.</p>
        <hr>

        <h2>Objetivo</h2>
        <p>Evitar o princípio de "Garbage In, Garbage Out" (GIGO), bloqueando a execução de cálculos se os dados de entrada violarem leis fundamentais da física e da química.</p>
        
        <h2>Validações Críticas (Bloqueiam o Sistema)</h2>
        <ul>
            <li><b>Vazão Inexistente:</b> <code>vazao_m3_dia ≤ 0</code>. Fluxo de massa requer vazão positiva.</li>
            <li><b>pH Incompatível:</b> <code>pH < 2.0</code> ou <code>pH > 12.0</code>. Fora da faixa de sobrevivência da biomassa.</li>
            <li><b>Impossibilidade Estequiométrica:</b> <code>DBO > DQO</code>. A parte (DBO) não pode ser maior que o todo (DQO).</li>
            <li><b>Limites Físicos:</b> Parâmetros como DBO, DQO, Temperatura fora de uma faixa razoável (ex: DBO > 50.000 mg/L).</li>
        </ul>

        <h2>Alertas Não Críticos</h2>
        <p>O sistema também emite alertas para dados que, embora possíveis, são suspeitos e podem indicar erros de digitação.</p>
        <ul>
            <li><b>Temperatura Elevada (> 50°C):</b> Sugere a necessidade de processos termofílicos.</li>
            <li><b>Razão DBO/DQO > 0.95:</b> Incomum na prática, pode ser erro de medição.</li>
        </ul>
    </div>
    
    <div class="page" id="cap-8">
        <div class="img-center">
            <img src="assets/images/aulas/prompt_08.png" alt="Roadmap de Desenvolvimento" class="img-large img-wide">
            <div class="img-caption">Figura 8: Roadmap visual do desenvolvimento dos módulos do sistema ETE.</div>
        </div>
        <h1>Capítulo 8: Próximos Passos Implementados</h1>
        <p>Registro do desenvolvimento do módulo de dimensionamento do reator.</p>
        <hr>

        <h2>O QUE FOI IMPLEMENTADO</h2>
        <p>Esta etapa do projeto focou em criar a classe <code>DimensionadorReator</code> e integrá-la aos cálculos existentes.</p>
        <ul>
            <li><b>Tabela `reatores` no Banco de Dados:</b> Para armazenar os parâmetros dos reatores.</li>
            <li><b>Módulo `dimensionamento.py`:</b> Contém a lógica para os seguintes cálculos:
                <ul>
                    <li><b>Cálculo de F/M:</b> <code>F/M = (Q × S₀) / (V × X)</code></li>
                    <li><b>Dimensionamento do Reator por F/M:</b> <code>V = (Q × S₀) / (F/M × X)</code></li>
                    <li><b>Cálculo de TDH (Tempo de Detenção Hidráulica):</b> <code>TDH = V / Q</code></li>
                    <li><b>Cálculo de Carga Volumétrica (Cv):</b> <code>Cv = (Q × S₀) / V</code></li>
                </ul>
            </li>
            <li><b>Validação de Dimensionamento:</b> Verifica se os parâmetros calculados (F/M, TDH, Cv) estão dentro de faixas técnicas aceitáveis.</li>
            <li><b>Integração com Cálculos Existentes:</b> Criação de um método `simular_tratamento_completo()` que une a simulação de demanda de O₂ com o dimensionamento do reator.</li>
        </ul>
        
        <h2>PRÓXIMOS PASSOS (Ainda Faltam)</h2>
        <ol>
            <li><b>Recirculação de Lodo:</b> Cálculo de R e Qr.</li>
            <li><b>Descarte de Lodo:</b> Cálculo de Px e Qw.</li>
            <li><b>Idade do Lodo (θc):</b> Cálculo e validação para nitrificação.</li>
            <li><b>Dimensionamento do Decantador:</b> Cálculo de área e validação de IVL.</li>
            <li><b>Balanço de Massa Completo:</b> Para validar a conservação de massa em todo o sistema.</li>
        </ol>
    </div>

    <div class="page" id="cap-9">
        <div class="img-center">
            <img src="assets/images/aulas/prompt_10.png" alt="Estrutura da Matriz de Petersen" class="img-large img-wide">
            <div class="img-caption">Figura 10: Estrutura da Matriz de Petersen mostrando processos, componentes e coeficientes estequiométricos.</div>
        </div>
        <h1>Capítulo 9: Matriz de Petersen - Teoria e Modelo Dinâmico</h1>
        <p>Este capítulo apresenta a <strong>Matriz de Petersen</strong>, um modelo dinâmico baseado em balanço de elétrons que permite cálculo exato da demanda de oxigênio. A Matriz de Petersen representa um avanço científico fundamental, elevando o simulador de aproximações empíricas para cálculos exatos baseados em princípios fundamentais da engenharia química.</p>
        <hr>

        <h2>1. POR QUE UM MODELO DINÂMICO?</h2>
        <p>As fórmulas estáticas tradicionais, como <code>O₂ = 1.42 × DBO</code>, são aproximações empíricas baseadas em correlações estatísticas. Embora úteis para estimativas rápidas, apresentam limitações fundamentais:</p>
        <ul>
            <li><b>Limitação de oxigênio:</b> Não consideram que, se a concentração de O₂ for baixa, o crescimento microbiano é limitado pela disponibilidade de oxigênio (efeito de Monod).</li>
            <li><b>Concentração de biomassa:</b> Ignoram que a demanda de O₂ é proporcional à concentração de microrganismos ativos (X_b) no reator.</li>
            <li><b>Decaimento e respiração endógena:</b> Não incluem o consumo de O₂ pela morte natural das bactérias e sua respiração endógena.</li>
            <li><b>Evolução temporal:</b> Assumem estado estacionário permanente, não permitindo análise de transientes ou otimização dinâmica.</li>
            <li><b>Balanço de elétrons:</b> Não garantem matematicamente a conservação de elétrons, base fundamental da estequiometria.</li>
        </ul>
        <div class="quadro">
            <b>Limitações Fundamentais da Fórmula Estática:</b><br>
            A fórmula <code>O₂ = 1.42 × DBO</code> é uma aproximação empírica que não considera limitação de O₂, concentração de biomassa, decaimento, evolução temporal ou balanço de elétrons. É adequada para estimativas preliminares, mas inadequada para dimensionamento preciso ou análise científica rigorosa.
        </div>

        <h2>2. A MATRIZ DE PETERSEN (ASM1 SIMPLIFICADO)</h2>
        <p>A <strong>Matriz de Petersen</strong> é uma estrutura matemática sistemática que organiza processos biológicos em uma matriz estequiométrica, baseada no modelo ASM1 (Activated Sludge Model 1), padrão internacional para modelagem de lodos ativados.</p>
        <p><strong>Estrutura da Matriz:</strong></p>
        <ul>
            <li><b>Linhas (Processos):</b> Representam os processos biológicos que ocorrem no reator:
                <ul>
                    <li><b>Processo 1 - Crescimento Aeróbio:</b> Bactérias consomem substrato e oxigênio para crescer e produzir nova biomassa.</li>
                    <li><b>Processo 2 - Decaimento (Morte):</b> Bactérias morrem naturalmente e consomem oxigênio na respiração endógena.</li>
                </ul>
            </li>
            <li><b>Colunas (Componentes):</b> Representam as espécies químicas envolvidas:
                <ul>
                    <li><b>S_s (Substrato Solúvel):</b> Matéria orgânica biodegradável (DBO solúvel).</li>
                    <li><b>X_b (Biomassa):</b> Concentração de microrganismos ativos (SSV - Sólidos Suspensos Voláteis).</li>
                    <li><b>S_o (Oxigênio Dissolvido):</b> Concentração de oxigênio disponível no reator.</li>
                </ul>
            </li>
            <li><b>Valores (Coeficientes Estequiométricos):</b> Cada célula da matriz contém o coeficiente estequiométrico que relaciona o processo à espécie química, garantindo conservação de massa e balanço de elétrons.</li>
        </ul>
        <pre><code>Matriz[Processo, Componente] = Coeficiente Estequiométrico

Processo 1: Crescimento Aeróbio
  - Consome substrato: -(1/Y)
  - Produz biomassa: +1
  - Consome oxigênio: -(1-Y)/Y

Processo 2: Decaimento (Morte)
  - Consome biomassa: -1
  - Consome oxigênio: -f_d × b (respiração endógena)</code></pre>

        <h2>3. BALANÇO DE ELÉTRONS - POR QUE O CÁLCULO É EXATO?</h2>
        <p>O cálculo da demanda de oxigênio pela Matriz de Petersen é <strong>exato</strong> porque respeita o princípio fundamental de <strong>conservação de elétrons</strong>, base da estequiometria química.</p>
        
        <h3>3.1 Princípio Fundamental</h3>
        <p>Em qualquer reação química, os elétrons não podem ser criados nem destruídos. Na oxidação biológica:</p>
        <div class="quadro">
            <b>Balanço de Elétrons:</b><br>
            <code>Elétrons no Substrato = Elétrons na Biomassa + Elétrons no O₂ consumido</code>
        </div>
        
        <h3>3.2 Coeficiente de Rendimento (Y)</h3>
        <p>O coeficiente de rendimento <code>Y</code> define exatamente qual fração do substrato é convertida em biomassa:</p>
        <ul>
            <li><b>Y = 0.6</b> significa que 60% do substrato (em termos de elétrons/energia) é convertido em biomassa.</li>
            <li>O restante <b>(1-Y) = 40%</b> precisa ser oxidado para fornecer energia ao processo.</li>
            <li>O oxigênio é o agente oxidante que aceita esses elétrons.</li>
        </ul>
        
        <h3>3.3 Cálculo Exato do Oxigênio</h3>
        <p>Para cada kg de biomassa produzida:</p>
        <pre><code>Substrato consumido = 1/Y kg
Elétrons no substrato = Elétrons na biomassa + Elétrons no O₂

Como Y% vira biomassa e (1-Y)% precisa ser oxidado:
O₂ necessário = (1-Y)/Y × Substrato consumido
O₂ necessário = (1-Y)/Y × (1/Y) = (1-Y)/Y kg O₂ por kg biomassa</code></pre>
        <p>Para <code>Y = 0.6</code>: <code>O₂ = (1-0.6)/0.6 = 0.67 kg O₂ / kg biomassa</code></p>
        
        <h3>3.4 Garantia Matemática</h3>
        <div class="quadro">
            <b>Por que é Exato:</b><br>
            1. <b>Conservação de Massa (Lavoisier):</b> A matriz estequiométrica garante que massa que entra = massa que sai + massa acumulada.<br>
            2. <b>Balanço de Elétrons:</b> Os coeficientes são calculados para garantir que todos os elétrons do substrato sejam contabilizados (biomassa + O₂).<br>
            3. <b>Base em Estequiometria Real:</b> Os coeficientes não são aproximações empíricas, mas valores derivados das reações químicas reais.<br>
            4. <b>Validação Experimental:</b> O modelo ASM1 foi validado em milhares de estações de tratamento reais.<br><br>
            <strong>Conclusão:</strong> Não é aproximação, é cálculo fundamental de Engenharia Química baseado em princípios físicos e químicos imutáveis.
        </div>

        <h2>4. TAXAS DE PROCESSO (CINÉTICA DE MONOD)</h2>
        <p>A Matriz de Petersen utiliza o modelo cinético de Monod para calcular as taxas de cada processo, considerando as limitações reais do sistema biológico.</p>
        
        <h3>4.1 Taxa de Crescimento Aeróbio</h3>
        <p>A taxa de crescimento microbiano segue o modelo de Monod, que considera limitação simultânea por substrato e oxigênio:</p>
        <pre><code>r_crescimento = μ_max × (S_s / (K_s + S_s)) × (S_o / (K_oh + S_o)) × X_b</code></pre>
        <p><strong>Parâmetros:</strong></p>
        <ul>
            <li><b>μ_max:</b> Taxa máxima de crescimento específica (1/dia). Valor típico: 4.0 1/dia para bactérias heterotróficas.</li>
            <li><b>K_s:</b> Constante de meia-saturação para substrato (mg/L). Valor típico: 20.0 mg/L. Representa a concentração de substrato na qual a taxa é metade da máxima.</li>
            <li><b>K_oh:</b> Constante de meia-saturação para oxigênio (mg/L). Valor típico: 0.5 mg/L. Representa a concentração de O₂ na qual a taxa é metade da máxima.</li>
            <li><b>S_s:</b> Concentração atual de substrato no reator (mg/L).</li>
            <li><b>S_o:</b> Concentração atual de oxigênio no reator (mg/L).</li>
            <li><b>X_b:</b> Concentração de biomassa ativa (mg/L). A taxa é proporcional à biomassa presente.</li>
        </ul>
        <p><strong>Interpretação:</strong></p>
        <ul>
            <li>Se <code>S_s >> K_s</code> e <code>S_o >> K_oh</code>: Taxa máxima (nenhuma limitação).</li>
            <li>Se <code>S_s << K_s</code>: Taxa limitada por substrato (crescimento lento).</li>
            <li>Se <code>S_o << K_oh</code>: Taxa limitada por oxigênio (crescimento anaeróbio ou limitado).</li>
        </ul>
        
        <h3>4.2 Taxa de Decaimento (Morte)</h3>
        <p>A taxa de decaimento é proporcional à biomassa presente, representando a morte natural e a respiração endógena:</p>
        <pre><code>r_decaimento = b × X_b</code></pre>
        <p><strong>Parâmetros:</strong></p>
        <ul>
            <li><b>b:</b> Taxa de decaimento específica (1/dia). Valor típico: 0.15 1/dia. Representa a fração da biomassa que morre por dia.</li>
            <li><b>X_b:</b> Concentração de biomassa (mg/L).</li>
        </ul>
        <p><strong>Interpretação:</strong> Se <code>b = 0.15 1/dia</code>, significa que 15% da biomassa morre naturalmente a cada dia, independentemente da disponibilidade de substrato.</p>
        
        <div class="quadro">
            <b>Vantagem do Modelo de Monod:</b> Permite modelar situações reais onde o crescimento é limitado por substrato ou oxigênio, algo impossível com fórmulas estáticas. Isso é crucial para dimensionamento preciso de aeradores e otimização de operação.
        </div>

        <h2>5. SIMULAÇÃO TEMPORAL (EQUAÇÕES DIFERENCIAIS)</h2>
        <p>A Matriz de Petersen permite simular a evolução temporal do sistema resolvendo um sistema de equações diferenciais ordinárias (EDOs) acopladas, representando os balanços de massa dinâmicos para cada componente.</p>
        
        <h3>5.1 Sistema de Equações Diferenciais</h3>
        <p>Para cada componente, o balanço de massa é:</p>
        <pre><code>d[Componente]/dt = Entrada - Saída + Produção - Consumo</code></pre>
        
        <p><strong>Para S_s (Substrato):</strong></p>
        <pre><code>dS_s/dt = d × (S_s_entrada - S_s) - (1/Y) × r_crescimento</code></pre>
        <ul>
            <li><b>Termo de entrada/saída:</b> <code>d × (S_s_entrada - S_s)</code> onde <code>d = Q/V</code> é a taxa de diluição (1/dia).</li>
            <li><b>Termo de consumo:</b> <code>-(1/Y) × r_crescimento</code> representa o substrato consumido no crescimento.</li>
        </ul>
        
        <p><strong>Para X_b (Biomassa):</strong></p>
        <pre><code>dX_b/dt = d × (X_b_entrada - X_b) + r_crescimento - r_decaimento</code></pre>
        <ul>
            <li><b>Termo de entrada/saída:</b> <code>d × (X_b_entrada - X_b)</code> considera recirculação de lodo.</li>
            <li><b>Termo de produção:</b> <code>+r_crescimento</code> representa nova biomassa produzida.</li>
            <li><b>Termo de consumo:</b> <code>-r_decaimento</code> representa biomassa que morre.</li>
        </ul>
        
        <p><strong>Para S_o (Oxigênio):</strong></p>
        <pre><code>dS_o/dt = d × (S_o_entrada - S_o) + O2_transferido - O2_consumido</code></pre>
        <ul>
            <li><b>Termo de entrada/saída:</b> <code>d × (S_o_entrada - S_o)</code> considera O₂ no efluente (geralmente baixo).</li>
            <li><b>Termo de transferência:</b> <code>+O2_transferido</code> representa O₂ fornecido pelos aeradores.</li>
            <li><b>Termo de consumo:</b> <code>-O2_consumido</code> representa O₂ consumido no crescimento e decaimento.</li>
        </ul>
        
        <h3>5.2 Resolução Numérica</h3>
        <p>O sistema de EDOs é resolvido numericamente usando métodos de integração (ex: <code>scipy.integrate.odeint</code>), permitindo:</p>
        <ul>
            <li><b>Análise de Transiente:</b> Simular partida do reator, mudanças de carga, ou perturbações.</li>
            <li><b>Estado Estacionário:</b> Determinar condições de equilíbrio onde <code>d/dt = 0</code>.</li>
            <li><b>Otimização:</b> Testar diferentes estratégias operacionais antes da implementação.</li>
            <li><b>Previsão:</b> Antecipar problemas e ajustar parâmetros preventivamente.</li>
        </ul>
        
        <div class="quadro">
            <b>Vantagem Fundamental:</b> A simulação temporal permite analisar o comportamento dinâmico do sistema, algo impossível com métodos estáticos. Isso é essencial para operação otimizada, diagnóstico de problemas e dimensionamento robusto que considere variações de carga.
        </div>

        <h2>6. COMPARAÇÃO: ESTÁTICO vs. DINÂMICO</h2>
        <div class="img-center">
            <img src="assets/images/aulas/prompt_11.png" alt="Comparação Estático vs Dinâmico" class="img-large img-wide">
            <div class="img-caption">Figura 11: Comparação visual entre cálculo estático (aproximação) e dinâmico (exato).</div>
        </div>
        <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
            <tr style="background: #e3f2fd;">
                <th style="padding: 10px; border: 1px solid #b3e5fc;">Aspecto</th>
                <th style="padding: 10px; border: 1px solid #b3e5fc;">Fórmula Estática</th>
                <th style="padding: 10px; border: 1px solid #b3e5fc;">Matriz de Petersen</th>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #b3e5fc;"><b>Base</b></td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">Aproximação empírica (1.42 × DBO)</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">Balanço de elétrons (exato)</td>
            </tr>
            <tr style="background: #f5f5f5;">
                <td style="padding: 10px; border: 1px solid #b3e5fc;"><b>Limitação de O₂</b></td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">❌ Não considera</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">✅ Considera (Monod)</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #b3e5fc;"><b>Decaimento</b></td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">❌ Não considera</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">✅ Considera respiração endógena</td>
            </tr>
            <tr style="background: #f5f5f5;">
                <td style="padding: 10px; border: 1px solid #b3e5fc;"><b>Biomassa</b></td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">❌ Não considera</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">✅ Considera concentração</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #b3e5fc;"><b>Temporal</b></td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">❌ Estático</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">✅ Dinâmico (varia no tempo)</td>
            </tr>
            <tr style="background: #f5f5f5;">
                <td style="padding: 10px; border: 1px solid #b3e5fc;"><b>Precisão</b></td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">Aproximação</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">Exato</td>
            </tr>
        </table>

        <h2>7. ESTEQUIOMETRIA IMPLEMENTADA</h2>
        <p>A matriz estequiométrica implementada no sistema segue exatamente os princípios descritos acima:</p>
        <pre><code>                S_s      X_b      S_o
Crescimento   -1/Y     +1      -(1-Y)/Y
Decaimento     0       -1      -f_d×b</code></pre>
        <p><strong>Coeficientes Numéricos (para Y=0.6, f_d=0.08, b=0.15):</strong></p>
        <ul>
            <li><b>Crescimento - S_s:</b> <code>-(1/Y) = -1.6667</code> kg substrato por kg biomassa</li>
            <li><b>Crescimento - X_b:</b> <code>+1.0000</code> kg biomassa produzida</li>
            <li><b>Crescimento - S_o:</b> <code>-(1-Y)/Y = -0.6667</code> kg O₂ por kg biomassa</li>
            <li><b>Decaimento - X_b:</b> <code>-1.0000</code> kg biomassa consumida</li>
            <li><b>Decaimento - S_o:</b> <code>-f_d×b = -0.0120</code> kg O₂ por kg biomassa (respiração endógena)</li>
        </ul>
        <div class="quadro">
            <b>Garantia de Conservação:</b> A multiplicação matricial <code>Matriz^T × Taxas</code> garante automaticamente que todos os balanços de massa sejam respeitados, validando matematicamente a conservação de massa e elétrons.
        </div>

        <h2>8. BALANÇO DE ELÉTRONS - DIAGRAMA CONCEITUAL</h2>
        <div class="img-center">
            <img src="assets/images/aulas/prompt_13.png" alt="Balanço de Elétrons" class="img-large img-wide">
            <div class="img-caption">Figura 12: Diagrama conceitual do balanço de elétrons que torna o cálculo exato.</div>
        </div>
        <p>O diagrama acima ilustra visualmente o princípio fundamental que torna o cálculo da Matriz de Petersen exato. Os elétrons do substrato são distribuídos entre biomassa e oxigênio, garantindo conservação matemática.</p>
        
        <h2>9. VANTAGENS DA MATRIZ DE PETERSEN</h2>
        <ol>
            <li><b>Cálculo Exato:</b> Baseado em balanço de elétrons, não é aproximação.</li>
            <li><b>Modelo Dinâmico:</b> Considera evolução temporal e permite análise de transiente.</li>
            <li><b>Limitações Realistas:</b> Considera limitação de substrato e oxigênio (Monod).</li>
            <li><b>Base Científica:</b> ASM1 (padrão internacional), validado em milhares de ETEs.</li>
        </ol>

        <hr>
        <p><b>Resumo:</b> A Matriz de Petersen representa um avanço científico no simulador, permitindo cálculos exatos baseados em princípios fundamentais da engenharia química, não em aproximações empíricas. O sistema agora é cientificamente soberano.</p>
    </div>

    <div class="page" id="cap-10">
        <div class="img-center">
            <img src="assets/images/aulas/prompt_12.png" alt="Simulação Temporal" class="img-large img-wide">
            <div class="img-caption">Figura 13: Evolução temporal de substrato, biomassa e oxigênio ao longo do tempo usando a Matriz de Petersen.</div>
        </div>
        <h1>Capítulo 10: Matriz de Petersen - Implementação e Integração</h1>
        <p>Este capítulo detalha a implementação prática da Matriz de Petersen no código, sua integração com o sistema existente, e como utilizar a simulação temporal para análise avançada do comportamento do reator biológico.</p>
        <hr>

        <h2>1. IMPLEMENTAÇÃO NO CÓDIGO</h2>
        <p>A Matriz de Petersen foi implementada no módulo <code>cinetica.py</code> através da classe <code>MatrizPetersen</code>, que encapsula toda a lógica de cálculo dinâmico.</p>
        
        <h3>1.1 Estrutura da Classe</h3>
        <p>A classe <code>MatrizPetersen</code> possui os seguintes componentes principais:</p>
        <ul>
            <li><b>Parâmetros Cinéticos:</b> Carregados do banco de dados (μ_max, K_s, K_oh, Y, b, f_d)</li>
            <li><b>Matriz Estequiométrica:</b> Construída automaticamente com base nos parâmetros</li>
            <li><b>Métodos de Cálculo:</b> Taxas, balanços de massa e demanda de oxigênio</li>
            <li><b>Simulação Temporal:</b> Resolução de equações diferenciais</li>
        </ul>
        
        <h3>1.2 Banco de Dados</h3>
        <p>Foi criada a tabela <code>parametros_cineticos</code> no SQLite para armazenar:</p>
        <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
            <tr style="background: #e3f2fd;">
                <th style="padding: 10px; border: 1px solid #b3e5fc;">Parâmetro</th>
                <th style="padding: 10px; border: 1px solid #b3e5fc;">Valor Padrão</th>
                <th style="padding: 10px; border: 1px solid #b3e5fc;">Unidade</th>
                <th style="padding: 10px; border: 1px solid #b3e5fc;">Descrição</th>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #b3e5fc;"><b>μ_max</b></td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">4.0</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">1/dia</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">Taxa máxima de crescimento</td>
            </tr>
            <tr style="background: #f5f5f5;">
                <td style="padding: 10px; border: 1px solid #b3e5fc;"><b>K_s</b></td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">20.0</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">mg/L</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">Constante de meia-saturação substrato</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #b3e5fc;"><b>K_oh</b></td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">0.5</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">mg/L</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">Constante de meia-saturação oxigênio</td>
            </tr>
            <tr style="background: #f5f5f5;">
                <td style="padding: 10px; border: 1px solid #b3e5fc;"><b>Y</b></td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">0.6</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">kg SSV/kg DBO</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">Coeficiente de rendimento</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #b3e5fc;"><b>b</b></td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">0.15</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">1/dia</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">Taxa de decaimento</td>
            </tr>
            <tr style="background: #f5f5f5;">
                <td style="padding: 10px; border: 1px solid #b3e5fc;"><b>f_d</b></td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">0.08</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">-</td>
                <td style="padding: 10px; border: 1px solid #b3e5fc;">Fração de biomassa que vira inerte</td>
            </tr>
        </table>
        
        <h3>1.3 Métodos Principais</h3>
        <p><strong>1. Cálculo de Taxas:</strong></p>
        <pre><code>taxa_crescimento = calcular_taxa_crescimento(s_s, s_o, x_b)
taxa_decaimento = calcular_taxa_decaimento(x_b)</code></pre>
        
        <p><strong>2. Balanço de Massa:</strong></p>
        <pre><code>balancos = calcular_balanco_massa(s_s, s_o, x_b)
# Retorna: consumo_substrato, producao_biomassa, consumo_oxigenio</code></pre>
        
        <p><strong>3. Demanda de Oxigênio:</strong></p>
        <pre><code>demanda = calcular_demanda_oxigenio(s_s, s_o, x_b, volume_m3)
# Retorna: demanda_crescimento, demanda_decaimento, demanda_total</code></pre>
        
        <p><strong>4. Simulação Temporal:</strong></p>
        <pre><code>evolucao = simular_evolucao_temporal(
    s_s_inicial, s_o_inicial, x_b_inicial,
    vazao_m3_dia, volume_m3, tempo_simulacao_dias
)
# Retorna: tempo, s_s, x_b, s_o, taxas, consumo_o2</code></pre>
        
        <h2>2. INTEGRAÇÃO COM CALCULOS.PY</h2>
        <p>A integração da Matriz de Petersen ao sistema principal foi realizada de forma que o usuário possa escolher entre método estático (rápido) ou dinâmico (preciso), mantendo compatibilidade total com o código existente.</p>
        
        <h3>2.1 Modificação do Método Principal</h3>
        <p>O método <code>calcular_demanda_oxigenio_total()</code> foi estendido para aceitar parâmetros opcionais:</p>
        <pre><code>def calcular_demanda_oxigenio_total(
    vazao_m3_dia: float,
    dbo_mg_l: float,
    tkn_mg_l: float,
    usar_matriz_petersen: bool = False,
    s_o: Optional[float] = None,
    x_b: Optional[float] = None,
    volume_m3: Optional[float] = None
) -> Dict[str, float]</code></pre>
        <p><strong>Comportamento:</strong></p>
        <ul>
            <li>Se <code>usar_matriz_petersen=False</code>: Usa método estático (comportamento original).</li>
            <li>Se <code>usar_matriz_petersen=True</code>: Valida parâmetros (s_o, x_b, volume_m3) e usa Matriz de Petersen.</li>
        </ul>
        
        <h3>2.2 Integração com Simulação Completa</h3>
        <p>O método <code>simular_tratamento_completo()</code> também aceita <code>usar_matriz_petersen</code>:</p>
        <ul>
            <li>Se ativado, dimensiona o reator primeiro para obter volume e concentrações.</li>
            <li>Recalcula demanda de O₂ usando Matriz de Petersen com valores corretos.</li>
            <li>Atualiza todos os resultados com valores do modelo dinâmico.</li>
        </ul>
        
        <h3>2.3 Interface Streamlit</h3>
        <p>Na interface visual, o usuário pode ativar a Matriz de Petersen através de um checkbox no sidebar:</p>
        <ul>
            <li><b>Checkbox "Usar Matriz de Petersen (Dinâmico)":</b> Quando marcado, todos os cálculos de demanda de O₂ usam o modelo dinâmico.</li>
            <li><b>Parâmetros Necessários:</b> O sistema solicita automaticamente concentração de O₂ no reator (S_o), concentração de biomassa (X_b) e volume do reator.</li>
            <li><b>Resultados Detalhados:</b> Mostra O₂ para crescimento e decaimento separadamente, além do total.</li>
            <li><b>Comparação Automática:</b> Apresenta diferença entre método estático e dinâmico.</li>
        </ul>
        
        <div class="img-center">
            <img src="assets/images/aulas/prompt_14.png" alt="Integração da Matriz de Petersen no Sistema" class="img-large img-wide">
            <div class="img-caption">Figura 14: Diagrama de integração da Matriz de Petersen com os módulos do sistema de simulação.</div>
        </div>
        <p>A imagem acima ilustra a arquitetura de integração, mostrando como a Matriz de Petersen se conecta com os diferentes módulos do sistema, mantendo compatibilidade total enquanto oferece capacidades científicas avançadas.</p>
        
        <h2>3. SIMULAÇÃO TEMPORAL</h2>
        <p>A simulação temporal permite analisar a evolução do sistema ao longo do tempo, resolvendo o sistema de equações diferenciais. A imagem acima mostra visualmente como as concentrações de substrato (S_s), biomassa (X_b) e oxigênio (S_o) evoluem ao longo do tempo.</p>
        
        <h3>3.1 Método de Simulação</h3>
        <p>O método <code>simular_evolucao_temporal()</code> em <code>cinetica.py</code> resolve o sistema de EDOs:</p>
        <pre><code>evolucao = matriz.simular_evolucao_temporal(
    s_s_inicial=200.0,      # mg/L (DBO inicial)
    s_o_inicial=2.0,        # mg/L (O2 inicial)
    x_b_inicial=1000.0,     # mg/L (biomassa inicial)
    vazao_m3_dia=500.0,     # m³/dia
    volume_m3=166.67,       # m³
    tempo_simulacao_dias=10.0,  # dias
    dt_dias=0.1             # passo de tempo
)</code></pre>
        
        <h3>3.2 Resultados da Simulação</h3>
        <p>O método retorna um dicionário com a evolução temporal de cada componente:</p>
        <ul>
            <li><b>tempo:</b> Lista de tempos (dias) da simulação.</li>
            <li><b>s_s:</b> Evolução da concentração de substrato (mg/L).</li>
            <li><b>x_b:</b> Evolução da concentração de biomassa (mg/L).</li>
            <li><b>s_o:</b> Evolução da concentração de oxigênio (mg/L).</li>
            <li><b>taxa_crescimento:</b> Taxa de crescimento ao longo do tempo.</li>
            <li><b>consumo_o2:</b> Consumo de O₂ ao longo do tempo.</li>
        </ul>
        
        <h3>3.3 Análise de Estado Estacionário</h3>
        <p>Após a simulação, é possível analisar o estado estacionário:</p>
        <ul>
            <li>Valores médios dos últimos 10% da simulação representam o estado estacionário.</li>
            <li>Demanda de O₂ no estado estacionário é calculada usando esses valores.</li>
            <li>Comparação com fórmula estática mostra a diferença real entre métodos.</li>
        </ul>
        
        <h2>4. USO PRÁTICO</h2>
        
        <h3>4.1 Interface Streamlit</h3>
        <p>Na interface visual:</p>
        <ol>
            <li>Marque "Usar Matriz de Petersen (Dinâmico)" no sidebar.</li>
            <li>Configure parâmetros normalmente (vazão, DBO, F/M, etc.).</li>
            <li>O sistema calcula automaticamente usando o modelo dinâmico.</li>
            <li>Veja comparação automática com fórmula estática.</li>
            <li>Analise resultados detalhados (O₂ para crescimento, decaimento, etc.).</li>
        </ol>
        
        <h3>4.2 Uso Programático</h3>
        <pre><code>from database import DatabaseManager
from calculos import CalculadorEfluentes

db = DatabaseManager("efluentes.db")
calculador = CalculadorEfluentes(db)

# Com Matriz de Petersen
demanda = calculador.calcular_demanda_oxigenio_total(
    vazao_m3_dia=500.0,
    dbo_mg_l=200.0,
    tkn_mg_l=30.0,
    usar_matriz_petersen=True,
    s_o=2.0,        # mg/L (O2 no reator)
    x_b=3000.0,    # mg/L (biomassa)
    volume_m3=166.67  # m³
)

print(f"Demanda Total: {demanda['demanda_total_kg_dia']:.2f} kg O2/dia")
print(f"Método: {demanda['metodo_usado']}")
print(f"O2 Crescimento: {demanda['demanda_crescimento_kg_dia']:.2f} kg/dia")
print(f"O2 Decaimento: {demanda['demanda_decaimento_kg_dia']:.2f} kg/dia")</code></pre>
        
        <h2>5. VANTAGENS DA INTEGRAÇÃO</h2>
        <div class="quadro">
            <b>Benefícios da Integração Completa:</b><br>
            1. <b>Flexibilidade:</b> Usuário escolhe entre método rápido (estático) ou preciso (dinâmico).<br>
            2. <b>Compatibilidade:</b> Código existente continua funcionando (método estático é padrão).<br>
            3. <b>Transparência:</b> Comparação automática mostra diferenças entre métodos.<br>
            4. <b>Precisão:</b> Modelo dinâmico oferece cálculos exatos baseados em princípios fundamentais.<br>
            5. <b>Análise Avançada:</b> Simulação temporal permite otimização e diagnóstico.<br>
            6. <b>Base Científica:</b> Sistema agora é cientificamente soberano, não dependente de aproximações empíricas.
        </div>
        
        <h2>6. DEPENDÊNCIAS</h2>
        <p><strong>Obrigatórias:</strong></p>
        <ul>
            <li><code>numpy>=1.21.0</code>: Para cálculos numéricos e operações matriciais.</li>
        </ul>
        <p><strong>Opcionais:</strong></p>
        <ul>
            <li><code>scipy>=1.7.0</code>: Necessário apenas para simulação temporal (método <code>simular_evolucao_temporal()</code>).</li>
        </ul>
        <p><strong>Nota:</strong> O sistema funciona completamente sem scipy, mas a simulação temporal requer scipy para integração numérica das EDOs.</p>
        
        <h2>7. STATUS FINAL DA IMPLEMENTAÇÃO</h2>
        <p><strong>Implementado com Sucesso:</strong></p>
        <ul>
            <li>✅ Matriz de Petersen completa (classe <code>MatrizPetersen</code> em <code>cinetica.py</code>)</li>
            <li>✅ Integração com <code>calculos.py</code> (método <code>calcular_demanda_oxigenio_total()</code>)</li>
            <li>✅ Simulação temporal (resolução de EDOs com <code>scipy.integrate.odeint</code>)</li>
            <li>✅ Interface Streamlit com opção para usar modelo dinâmico</li>
            <li>✅ Comparação automática estático vs. dinâmico</li>
            <li>✅ Banco de dados com tabela <code>parametros_cineticos</code></li>
            <li>✅ Documentação completa e testes</li>
        </ul>
        
        <p><strong>Sistema Agora:</strong></p>
        <div class="quadro">
            <b>Conquista Científica:</b><br>
            - <b>Cientificamente Soberano:</b> Baseado em princípios fundamentais (balanço de elétrons, conservação de massa)<br>
            - <b>Dinâmico:</b> Considera evolução temporal e permite análise de transiente<br>
            - <b>Exato:</b> Balanço de elétrons garantido matematicamente<br>
            - <b>Flexível:</b> Usuário escolhe entre método estático (rápido) ou dinâmico (preciso)<br>
            - <b>Validado:</b> Baseado em ASM1, padrão internacional validado em milhares de ETEs<br><br>
            <strong>O cálculo de O₂ agora é EXATO porque respeita o balanço de elétrons, não sendo uma aproximação empírica!</strong>
        </div>
        
        <hr>
        <p><b>Conclusão do Capítulo:</b> A integração completa da Matriz de Petersen ao sistema permite que engenheiros escolham o nível de precisão necessário para cada análise, desde estimativas rápidas até cálculos exatos com simulação temporal. O sistema mantém compatibilidade total enquanto oferece capacidades científicas avançadas, elevando o simulador de um sistema baseado em aproximações empíricas para um modelo dinâmico cientificamente soberano.</p>
    </div>

    <div class="page" id="cap-conc">
        <div class="img-center">
            <img src="assets/images/aulas/prompt_09.png" alt="Conclusão e Equipe" class="img-large img-tall">
            <div class="img-caption">Figura 15: Equipe de engenheiros celebrando o sucesso do projeto e consolidação do conhecimento.</div>
        </div>
        <h1>Conclusão</h1>
        <p>Esta apostila apresentou uma visão consolidada e estruturada da documentação do projeto "Simulador de Efluentes". Através dos capítulos, exploramos desde os conceitos teóricos fundamentais até os detalhes de implementação de cada componente do sistema de tratamento de lodos ativados.</p>
        <p>Fica evidente a robustez do sistema, que não apenas realiza os cálculos de dimensionamento e operacionais, mas também os valida contra princípios da termodinâmica e normas legais, garantindo resultados coerentes e confiáveis.</p>
        <p>O destaque especial vai para a implementação da <strong>Matriz de Petersen</strong>, que eleva o simulador de um sistema baseado em aproximações empíricas para um modelo dinâmico cientificamente soberano, baseado em balanço de elétrons e princípios fundamentais da engenharia química.</p>
        <p>A estrutura modular e a filosofia de desenvolvimento baseada em "Física antes da Lógica" tornam o projeto uma excelente ferramenta de estudo e um poderoso simulador para engenheiros da área ambiental e química. O material aqui compilado serve como um registro permanente e um guia de referência para o uso, manutenção e evolução futura do sistema.</p>
        <div class="quadro">
            <b>Conquista Científica:</b> O cálculo de O₂ agora é EXATO porque respeita o balanço de elétrons, não sendo uma aproximação empírica. O sistema alcançou soberania científica.
        </div>
        
        <hr>
        
        <h2>Autor</h2>
        <div class="quadro">
            <b>Christian Vladimir Uhdre Mulato</b><br>
            Diplomado em Engenharia Química - Universidade Federal do Paraná (UFPR)<br>
            Setor de Tecnologia da UFPR<br>
            Registro: 2338<br>
            <a href="https://tecnologia.ufpr.br/cceq/graduacao/diploma/" target="_blank">tecnologia.ufpr.br/cceq/graduacao/diploma/</a>
        </div>
        
        <div class="quadro">
            <p><strong>Dedicatória:</strong></p>
            <p style="font-style: italic; margin-top: 10px;">Ao Prof. Urivald Pawlowski, que nos ensinou que o código sem a física é apenas ruído, e que a verdadeira engenharia nasce da compreensão profunda dos fenômenos. Obrigado por nos mostrar o caminho da soberania técnica.</p>
        </div>
        
        <p>Este projeto foi desenvolvido como uma ferramenta de simulação e dimensionamento de Estações de Tratamento de Efluentes, combinando conhecimentos de Engenharia Química com desenvolvimento de software, seguindo a filosofia de "Física antes da Lógica".</p>
        
        <p><strong>Desenvolvido com rigor científico e paixão pela Engenharia Química</strong> 🧪⚗️</p>
    </div>

</body>
</html>
