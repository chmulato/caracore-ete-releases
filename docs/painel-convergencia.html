<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Convergência Matemática — Ouro 4.0 | caracore-ete-releases</title>
    <meta name="description" content="Visualize a intersecção de funções como o ponto de solução: titulação pH, saturação de O2. Equações do Prof. Pawlowsky em gráficos interativos.">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/loja.css">
    <link rel="stylesheet" href="assets/evolution-status/evolution-status.css">
    <style>
        :root {
            --bg-dark: #0a0e14;
            --bg-panel: #12171f;
            --bg-card: #1a2028;
            --border: #2d3748;
            --text: #e6edf3;
            --text-dim: #8b949e;
            --neon-cyan: #00f5d4;
            --neon-magenta: #f72585;
            --neon-amber: #ffd60a;
            --neon-green: #00f5a0;
            --accent-blue: #58a6ff;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            padding: 24px 20px 48px;
        }
        .wrapper { max-width: 1100px; margin: 0 auto; }
        header {
            text-align: center;
            padding: 32px 0 40px;
            border-bottom: 1px solid var(--border);
        }
        header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--neon-cyan);
            text-shadow: 0 0 20px rgba(0,245,212,0.3);
            margin-bottom: 8px;
        }
        header p {
            color: var(--text-dim);
            font-size: 0.95rem;
            max-width: 560px;
            margin: 0 auto;
            line-height: 1.6;
        }
        .panel-section {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
        }
        .panel-section h2 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--neon-amber);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .panel-section h2::before {
            content: '';
            width: 4px;
            height: 1.1em;
            background: var(--neon-amber);
            border-radius: 2px;
        }
        .chart-container {
            width: 100%;
            height: 380px;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            background: var(--bg-card);
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 16px;
        }
        .control-group label {
            display: block;
            font-size: 0.8rem;
            color: var(--text-dim);
            margin-bottom: 6px;
        }
        .control-group input[type="range"] {
            width: 100%;
            height: 8px;
            accent-color: var(--neon-cyan);
            background: var(--bg-card);
            border-radius: 4px;
        }
        .control-group .value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--neon-cyan);
            margin-top: 4px;
        }
        .solution-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(0,245,160,0.12);
            border: 1px solid var(--neon-green);
            border-radius: 8px;
            margin-top: 12px;
            font-size: 0.9rem;
            color: var(--neon-green);
            box-shadow: 0 0 20px rgba(0,245,160,0.2);
        }
        .solution-badge.sparkle {
            animation: sparkle 0.6s ease-out;
        }
        @keyframes sparkle {
            0% { box-shadow: 0 0 0 0 rgba(0,245,160,0.6); }
            70% { box-shadow: 0 0 30px 12px rgba(0,245,160,0.3); }
            100% { box-shadow: 0 0 20px rgba(0,245,160,0.2); }
        }
        .nav-links {
            margin-top: 32px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            font-size: 0.9rem;
        }
        .nav-links a {
            color: var(--accent-blue);
            text-decoration: none;
        }
        .nav-links a:hover { text-decoration: underline; }
        .sound-toggle {
            margin-top: 12px;
            font-size: 0.8rem;
            color: var(--text-dim);
        }
        .sound-toggle label { cursor: pointer; display: inline-flex; align-items: center; gap: 6px; }
    </style>
</head>
<body>
    <div class="wrapper">
        <header>
            <h1>Painel de Convergência Matemática</h1>
            <p>Onde as equações do Prof. Pawlowsky ganham vida: a intersecção das curvas é o <strong>ponto de solução</strong> — pH, O₂ e precipitação revelados como revelação visual.</p>
        </header>

        <section class="panel-section" id="secao-ph">
            <h2>Curva de Titulação — pH vs Volume de Titulante</h2>
            <p style="color: var(--text-dim); font-size: 0.9rem; margin-bottom: 16px;">Múltiplas curvas para diferentes concentrações. O <strong>Ponto de Equivalência</strong> (pH 7.0) é a solução ideal de neutralização. Use o zoom do gráfico para aproximar o ponto exato.</p>
            <div id="chart-ph" class="chart-container"></div>
            <div class="controls">
                <div class="control-group">
                    <label>Concentração ácido (mol/L)</label>
                    <input type="range" id="slider-ph-conc" min="0.01" max="0.5" step="0.01" value="0.1">
                    <div class="value" id="val-ph-conc">0.10</div>
                </div>
                <div class="control-group">
                    <label>Volume inicial (mL)</label>
                    <input type="range" id="slider-ph-vol" min="20" max="100" value="50">
                    <div class="value" id="val-ph-vol">50 mL</div>
                </div>
            </div>
            <div id="badge-ph" class="solution-badge">Solução Ótima — Ponto de Equivalência pH 7.0</div>
        </section>

        <section class="panel-section" id="secao-o2">
            <h2>Eficiência do Oxigênio — Saturação O₂ vs Tempo / Fatores</h2>
            <p style="color: var(--text-dim); font-size: 0.9rem; margin-bottom: 16px;">Curva de concentração de O₂. A linha <strong>Concentração Crítica para Vida Aquática</strong> mostra o mínimo para ecossistemas saudáveis. Acima = vida prosperando; abaixo = em risco.</p>
            <div id="chart-o2" class="chart-container"></div>
            <div class="controls">
                <div class="control-group">
                    <label>Taxa de aeração (relativo)</label>
                    <input type="range" id="slider-o2-aer" min="0.2" max="2" step="0.1" value="1">
                    <div class="value" id="val-o2-aer">1.0</div>
                </div>
                <div class="control-group">
                    <label>Concentração crítica O₂ (mg/L)</label>
                    <input type="range" id="slider-o2-crit" min="4" max="10" step="0.5" value="5">
                    <div class="value" id="val-o2-crit">5.0 mg/L</div>
                </div>
            </div>
            <div id="badge-o2" class="solution-badge">Status: aguardando interseção</div>
            <p class="sound-toggle"><label><input type="checkbox" id="sound-enabled" checked> Som de descoberta ao atingir a solução</label></p>
        </section>

        <p class="nav-links">
            <a href="index.html">← Voltar ao portal</a> · <a href="laboratorio_campo_largo.html">Laboratório Campo Largo: Ouro 4.0</a> · <a href="canal-feedback.html">Canal de Melhorias</a>
        </p>
    </div>

    <script>
        (function() {
            const darkLayout = {
                paper_bgcolor: '#1a2028',
                plot_bgcolor: '#1a2028',
                font: { color: '#8b949e', family: 'Inter, sans-serif' },
                title: { font: { color: '#e6edf3', size: 14 } },
                xaxis: { gridcolor: '#2d3748', zerolinecolor: '#2d3748' },
                yaxis: { gridcolor: '#2d3748', zerolinecolor: '#2d3748' },
                margin: { t: 40, r: 40, b: 50, l: 60 },
                showlegend: true,
                legend: { bgcolor: 'rgba(0,0,0,0)', font: { color: '#8b949e' }, orientation: 'h', y: 1.08 }
            };

            // ---- Curva de Titulação (pH vs Volume) — modelo suave tipo sigmoide ----
            function titrationCurve(V_acid, C_acid, V_titrant_max) {
                const pts = [];
                const n = 100;
                const Veq = (C_acid * V_acid) / 0.1; // volume equivalente (base 0.1 M)
                const steep = 8 / Math.max(Veq * 0.15, 5); // inclinação no ponto de equivalência
                for (let i = 0; i <= n; i++) {
                    const V = (V_titrant_max * i) / n;
                    // Sigmóide suave: pH baixo -> alto ao passar por Veq
                    const xNorm = (V - Veq) * steep;
                    const pH = 2.5 + (11.5 / (1 + Math.exp(-xNorm)));
                    pts.push({ x: V, y: Math.max(1.5, Math.min(13, pH)) });
                }
                return pts;
            }

            function updateChartPH() {
                const conc = parseFloat(document.getElementById('slider-ph-conc').value);
                const vol = parseFloat(document.getElementById('slider-ph-vol').value);
                document.getElementById('val-ph-conc').textContent = conc.toFixed(2);
                document.getElementById('val-ph-vol').textContent = vol + ' mL';

                const V_max = 120;
                const curves = [
                    { c: conc, label: 'Concentração atual' },
                    { c: conc * 0.5, label: 'Concentração 0.5×' },
                    { c: Math.min(0.5, conc * 1.5), label: 'Concentração 1.5×' }
                ];
                const data = curves.map((cur, i) => {
                    const pts = titrationCurve(vol, cur.c, V_max);
                    return {
                        x: pts.map(p => p.x),
                        y: pts.map(p => p.y),
                        type: 'scatter',
                        mode: 'lines',
                        name: cur.label,
                        line: { width: 2.5, color: i === 0 ? '#00f5d4' : (i === 1 ? '#f72585' : '#ffd60a') },
                        hovertemplate: 'Volume: %{x:.1f} mL<br>pH: %{y:.2f}<extra></extra>'
                    };
                });
                const Veq = (conc * vol) / 0.1;
                const pH_eq = 7.0;
                data.push({
                    x: [Veq],
                    y: [pH_eq],
                    type: 'scatter',
                    mode: 'markers+text',
                    name: 'Ponto de Equivalência',
                    marker: { size: 16, color: '#00f5a0', symbol: 'diamond', line: { width: 2, color: '#fff' } },
                    text: ['pH 7.0'],
                    textposition: 'top center',
                    textfont: { color: '#00f5a0', size: 12 },
                    hovertemplate: 'Solução Ótima — pH 7.0<extra></extra>'
                });
                const layout = {
                    ...darkLayout,
                    xaxis: { ...darkLayout.xaxis, title: 'Volume de titulante (mL)', titlefont: { color: '#e6edf3' } },
                    yaxis: { ...darkLayout.yaxis, title: 'pH', titlefont: { color: '#e6edf3' }, range: [1, 14] },
                    annotations: [{
                        x: Veq, y: pH_eq, text: 'Solução Ótima — pH 7.0', showarrow: true, arrowhead: 2,
                        ax: 0, ay: -40, font: { color: '#00f5a0', size: 11 }, bgcolor: 'rgba(0,0,0,0.7)', borderpad: 6
                    }]
                };
                Plotly.react('chart-ph', data, layout, { responsive: true, displayModeBar: true, scrollZoom: true });
                document.getElementById('badge-ph').classList.add('sparkle');
                setTimeout(() => document.getElementById('badge-ph').classList.remove('sparkle'), 600);
            }

            document.getElementById('slider-ph-conc').addEventListener('input', updateChartPH);
            document.getElementById('slider-ph-vol').addEventListener('input', updateChartPH);

            // ---- Curva de Saturação O2 ----
            function o2SaturationCurve(aeration, tMax) {
                const pts = [];
                const O2_sat = 9.0; // mg/L saturação
                const n = 60;
                for (let i = 0; i <= n; i++) {
                    const t = (tMax * i) / n;
                    const O2 = O2_sat * (1 - Math.exp(-aeration * t / 15));
                    pts.push({ x: t, y: O2 });
                }
                return pts;
            }

            function updateChartO2() {
                const aeration = parseFloat(document.getElementById('slider-o2-aer').value);
                const crit = parseFloat(document.getElementById('slider-o2-crit').value);
                document.getElementById('val-o2-aer').textContent = aeration.toFixed(1);
                document.getElementById('val-o2-crit').textContent = crit.toFixed(1) + ' mg/L';

                const tMax = 60;
                const pts = o2SaturationCurve(aeration, tMax);
                const tIntersect = 15 * Math.log(1 / (1 - crit / 9)) / aeration;
                const crosses = tIntersect > 0 && tIntersect < tMax;

                const data = [
                    {
                        x: pts.map(p => p.x),
                        y: pts.map(p => p.y),
                        type: 'scatter',
                        mode: 'lines',
                        name: 'Concentração O₂',
                        line: { width: 3, color: '#00f5d4' },
                        hovertemplate: 'Tempo: %{x:.1f} min<br>O₂: %{y:.2f} mg/L<extra></extra>'
                    },
                    {
                        x: [0, tMax],
                        y: [crit, crit],
                        type: 'scatter',
                        mode: 'lines',
                        name: 'Crítica para vida aquática',
                        line: { width: 2, color: '#f72585', dash: 'dash' },
                        hovertemplate: 'Limiar: ' + crit + ' mg/L<extra></extra>'
                    }
                ];
                if (crosses) {
                    data.push({
                        x: [tIntersect],
                        y: [crit],
                        type: 'scatter',
                        mode: 'markers+text',
                        name: 'Ponto de convergência',
                        marker: { size: 18, color: '#00f5a0', symbol: 'diamond', line: { width: 2, color: '#fff' } },
                        text: ['Vida prosperando a partir daqui'],
                        textposition: 'top center',
                        textfont: { color: '#00f5a0', size: 10 },
                        hovertemplate: 't ≈ ' + tIntersect.toFixed(1) + ' min<extra></extra>'
                    });
                }
                const layout = {
                    ...darkLayout,
                    xaxis: { ...darkLayout.xaxis, title: 'Tempo (min)', titlefont: { color: '#e6edf3' } },
                    yaxis: { ...darkLayout.yaxis, title: 'O₂ (mg/L)', titlefont: { color: '#e6edf3' }, range: [0, 10] },
                    annotations: crosses ? [{
                        x: tIntersect, y: crit, text: 'Solução: O₂ ≥ crítico', showarrow: true, arrowhead: 2,
                        ax: 0, ay: -35, font: { color: '#00f5a0', size: 11 }, bgcolor: 'rgba(0,0,0,0.7)', borderpad: 6
                    }] : []
                };
                Plotly.react('chart-o2', data, layout, { responsive: true, displayModeBar: true, scrollZoom: true });

                const badge = document.getElementById('badge-o2');
                if (crosses) {
                    badge.textContent = '✓ Vida prosperando — O₂ atinge concentração crítica em t ≈ ' + tIntersect.toFixed(1) + ' min';
                    badge.classList.add('sparkle');
                    if (document.getElementById('sound-enabled').checked) {
                        try {
                            const ctx = new (window.AudioContext || window.webkitAudioContext)();
                            const o = ctx.createOscillator();
                            const g = ctx.createGain();
                            o.connect(g); g.connect(ctx.destination);
                            o.frequency.value = 880; o.type = 'sine';
                            g.gain.setValueAtTime(0.08, ctx.currentTime);
                            g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
                            o.start(ctx.currentTime); o.stop(ctx.currentTime + 0.15);
                        } catch (_) {}
                    }
                } else {
                    badge.textContent = crit > 9 ? 'Concentração crítica acima da saturação (ajuste o parâmetro)' : 'Aguarde: curva ainda não cruza o limiar no intervalo';
                }
                setTimeout(() => badge.classList.remove('sparkle'), 600);
            }

            document.getElementById('slider-o2-aer').addEventListener('input', updateChartO2);
            document.getElementById('slider-o2-crit').addEventListener('input', updateChartO2);
            document.getElementById('sound-enabled').addEventListener('change', function() { if (this.checked) updateChartO2(); });

            updateChartPH();
            updateChartO2();
        })();
    </script>
    <script src="assets/js/loja.js"></script>
    <div class="evo-beta-wrap" aria-hidden="true"><span class="evo-beta-badge" title="Versão de teste oficial">Seed<span class="evo-beta-tooltip">Esta é uma versão oficial de teste da Cara Core Informática para parceiros do Plano Premium+.</span></span></div>
    <footer class="evo-roadmap-footer" role="contentinfo"><p class="evo-roadmap-title">Próximos passos</p><ul class="evo-roadmap-list"><li>Domínio próprio <span class="evo-roadmap-tag">Março/2026</span></li><li>Integração PIX nativa</li><li>IA para estoque</li></ul></footer>
    <div class="evo-feedback-fab"><a href="https://wa.me/5541999097797?text=Olá!%20Sugestão%20de%20melhoria%20para%20a%20loja%20em%20fase%20Seed%20—%20Cara%20Core%20Informática." class="evo-feedback-btn" target="_blank" rel="noopener noreferrer" aria-label="Sugira uma melhoria pelo WhatsApp"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg> Sugira uma melhoria</a></div>
</body>
</html>
